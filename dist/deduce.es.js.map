{"version":3,"file":"deduce.es.js","sources":["../src/index.js"],"sourcesContent":["export default function(state = {}, reducers = {}) {\n\tconst listeners = new Set();\n\tlet isDispatching = false;\n\n\tfunction dispatch(reducer, args) {\n\t\tif (isDispatching) {\n\t\t\tthrow new Error('Infinite loop detected.');\n\t\t}\n\n\t\tisDispatching = true;\n\n\t\ttry {\n\t\t\tstate = reducer(state, ...args);\n\n\t\t\tlisteners.forEach(x => x());\n\t\t} catch (err) {\n\t\t\tisDispatching = false;\n\n\t\t\tthrow err;\n\t\t}\n\n\t\tisDispatching = false;\n\t}\n\n\tfunction addReducer(obj, name, reducer) {\n\t\tif (typeof reducer !== 'function') {\n\t\t\tthrow new TypeError(`Reducer must be a function: ${name}`);\n\t\t}\n\n\t\tif (name in obj) {\n\t\t\tthrow new Error(`Reducer exists: ${name}`);\n\t\t}\n\n\t\tobj[name] = (...args) => {\n\t\t\tdispatch(reducer, args);\n\n\t\t\treturn obj;\n\t\t};\n\t}\n\n\tfunction addReducerFor(property, obj, name, reducer) {\n\t\tif (typeof reducer !== 'function') {\n\t\t\tthrow new TypeError(`Reducer must be a function: ${name}`);\n\t\t}\n\n\t\taddReducer(obj, name, (state, ...args) =>\n\t\t\tObject.assign(state, {\n\t\t\t\t[property]: reducer(state[property], ...args),\n\t\t\t})\n\t\t);\n\t}\n\n\tconst store = {\n\t\tget state() {\n\t\t\treturn state;\n\t\t},\n\n\t\taddReducers(reducers) {\n\t\t\tObject.keys(reducers).forEach(name => {\n\t\t\t\taddReducer(this, name, reducers[name]);\n\t\t\t});\n\n\t\t\treturn this;\n\t\t},\n\n\t\taddReducersFor(property, reducers) {\n\t\t\tObject.keys(reducers).forEach(name => {\n\t\t\t\taddReducerFor(property, this, name, reducers[name]);\n\t\t\t});\n\n\t\t\treturn this;\n\t\t},\n\n\t\taddListener(listener) {\n\t\t\tif (typeof listener !== 'function') {\n\t\t\t\tthrow new TypeError(`Listener must be a function.`);\n\t\t\t}\n\n\t\t\tlisteners.add(listener);\n\n\t\t\treturn () => {\n\t\t\t\tlisteners.delete(listener);\n\t\t\t};\n\t\t},\n\t};\n\n\treturn store.addReducers(reducers);\n}\n"],"names":[],"mappings":"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"}